<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <select></select>
    <button>AÃ±adir Notas</button><br/>
    <textarea style="width: 100%"></textarea>
    <script>
        const cbTitulos = document.querySelector("select");
        const txtNota = document.querySelector("textarea");
        let estado;
        const setEstado = (nuevoEstado) => {
            cbTitulos.textContent = "";
            Object.keys(nuevoEstado.notas).forEach((nombre) => {
                const opcion = document.createElement("option");
                opcion.textContent = nombre;
                if(nuevoEstado.seleccionada == nombre) opcion.selected = true;
                cbTitulos.appendChild(opcion);
            })
            txtNota.value = nuevoEstado.notas[nuevoEstado.seleccionada];

            localStorage.setItem("Notas", JSON.stringify(nuevoEstado));
            estado = nuevoEstado;
        }
        setEstado(
            JSON.parse(localStorage.getItem("Notas")) || {
                notas: {"Lista de la compra": "Zanahorias\nTomates"},
                seleccionada: "Lista de la compra"
        })

        cbTitulos.addEventListener("change", () =>{
            setEstado({notas: estado.notas, seleccionada: cbTitulos.value})
        });

        txtNota.addEventListener("change", () =>{
            setEstado(
                {
                    notas: Object.assign({}, estado.notas, {
                        [estado.seleccionada]: txtNota.value
                    }),
                        seleccionada: estado.seleccionada
                }
            )
        })

        document.querySelector("button").addEventListener("click",
            () => {
                let nombre = prompt("Nombre de Nota")
                if(nombre) setEstado(
                    {
                        notas: Object.assign(
                            {},
                            estado.notas,
                            {
                                [nombre]: ""
                            }
                        ),
                        seleccionada: nombre,
                    }
                )
            }
        )

    </script>
</body>
</html>